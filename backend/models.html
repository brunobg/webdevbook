<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Models | A full stack approach to integrated web and native app development</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Creating native and web apps using Vue, NativeScript and Laravel">
    <link rel="preload" href="/webdevbook/assets/css/0.styles.6f5b36b1.css" as="style"><link rel="preload" href="/webdevbook/assets/js/app.644400d4.js" as="script"><link rel="preload" href="/webdevbook/assets/js/2.853235cf.js" as="script"><link rel="preload" href="/webdevbook/assets/js/16.e92f5043.js" as="script"><link rel="prefetch" href="/webdevbook/assets/js/10.6f65ccae.js"><link rel="prefetch" href="/webdevbook/assets/js/11.328f3311.js"><link rel="prefetch" href="/webdevbook/assets/js/12.16a32824.js"><link rel="prefetch" href="/webdevbook/assets/js/13.1aeeb621.js"><link rel="prefetch" href="/webdevbook/assets/js/14.95d7855b.js"><link rel="prefetch" href="/webdevbook/assets/js/15.839fc64f.js"><link rel="prefetch" href="/webdevbook/assets/js/17.06511f72.js"><link rel="prefetch" href="/webdevbook/assets/js/18.c03eea47.js"><link rel="prefetch" href="/webdevbook/assets/js/19.ab4689ea.js"><link rel="prefetch" href="/webdevbook/assets/js/20.31d0c894.js"><link rel="prefetch" href="/webdevbook/assets/js/21.ba6ba376.js"><link rel="prefetch" href="/webdevbook/assets/js/22.53e01e7c.js"><link rel="prefetch" href="/webdevbook/assets/js/23.d4b914f3.js"><link rel="prefetch" href="/webdevbook/assets/js/24.c67cdad2.js"><link rel="prefetch" href="/webdevbook/assets/js/25.422d1d75.js"><link rel="prefetch" href="/webdevbook/assets/js/26.7cd55c1a.js"><link rel="prefetch" href="/webdevbook/assets/js/27.439bde24.js"><link rel="prefetch" href="/webdevbook/assets/js/28.726c0dbb.js"><link rel="prefetch" href="/webdevbook/assets/js/29.d5d9e943.js"><link rel="prefetch" href="/webdevbook/assets/js/3.d727a3b8.js"><link rel="prefetch" href="/webdevbook/assets/js/30.e36fbcc1.js"><link rel="prefetch" href="/webdevbook/assets/js/31.a3d2335a.js"><link rel="prefetch" href="/webdevbook/assets/js/32.3d462098.js"><link rel="prefetch" href="/webdevbook/assets/js/33.6e697ec6.js"><link rel="prefetch" href="/webdevbook/assets/js/34.6137b7ff.js"><link rel="prefetch" href="/webdevbook/assets/js/35.14e619f1.js"><link rel="prefetch" href="/webdevbook/assets/js/36.02397366.js"><link rel="prefetch" href="/webdevbook/assets/js/37.836a2c36.js"><link rel="prefetch" href="/webdevbook/assets/js/38.2fde44a2.js"><link rel="prefetch" href="/webdevbook/assets/js/39.b19a8df2.js"><link rel="prefetch" href="/webdevbook/assets/js/4.32e8b916.js"><link rel="prefetch" href="/webdevbook/assets/js/5.85ec4918.js"><link rel="prefetch" href="/webdevbook/assets/js/6.423fdf70.js"><link rel="prefetch" href="/webdevbook/assets/js/7.1257df8e.js"><link rel="prefetch" href="/webdevbook/assets/js/8.1f0319bc.js"><link rel="prefetch" href="/webdevbook/assets/js/9.c815df7c.js">
    <link rel="stylesheet" href="/webdevbook/assets/css/0.styles.6f5b36b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/webdevbook/" class="home-link router-link-active"><!----> <span class="site-name">A full stack approach to integrated web and native app development</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/webdevbook/" aria-current="page" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Backend</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webdevbook/backend/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/webdevbook/backend/architecture.html" class="sidebar-link">Architecture</a></li><li><a href="/webdevbook/backend/structure.html" class="sidebar-link">Code structure</a></li><li><a href="/webdevbook/backend/setup.html" class="sidebar-link">Setup the project</a></li><li><a href="/webdevbook/backend/testing.html" class="sidebar-link">Testing</a></li><li><a href="/webdevbook/backend/models.html" aria-current="page" class="active sidebar-link">Models</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#models-types-in-graphql" class="sidebar-link">Models (types) in Graphql</a></li><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#relationships" class="sidebar-link">Relationships</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#one-to-one-relationships" class="sidebar-link">One to one relationships</a></li><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#one-to-many-relationships" class="sidebar-link">One to many relationships</a></li><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#many-to-many-relationships" class="sidebar-link">Many to many relationships</a></li><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#polymorphic-relationships" class="sidebar-link">Polymorphic relationships</a></li><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#polymorphic-one-to-one" class="sidebar-link">Polymorphic one-to-one</a></li><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#polymorphic-many-to-one" class="sidebar-link">Polymorphic many-to-one</a></li><li class="sidebar-sub-header"><a href="/webdevbook/backend/models.html#polymorphic-many-to-many" class="sidebar-link">Polymorphic many-to-many</a></li></ul></li></ul></li><li><a href="/webdevbook/backend/database.html" class="sidebar-link">Database</a></li><li><a href="/webdevbook/backend/routing.html" class="sidebar-link">Routing</a></li><li><a href="/webdevbook/backend/controllers.html" class="sidebar-link">Controllers</a></li><li><a href="/webdevbook/backend/authentication.html" class="sidebar-link">Authentication</a></li><li><a href="/webdevbook/backend/security.html" class="sidebar-link">/backend/security.html</a></li><li><a href="/webdevbook/backend/deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/webdevbook/backend/ssr.html" class="sidebar-link">Server side rendering</a></li><li><a href="/webdevbook/backend/media.html" class="sidebar-link">Media</a></li><li><a href="/webdevbook/backend/pushcommunication.html" class="sidebar-link">Push communication</a></li><li><a href="/webdevbook/backend/scraping.html" class="sidebar-link">Scraping and crawlers</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="models"><a href="#models" class="header-anchor">#</a> Models</h1> <p>Each &quot;thing&quot; in your application will be a model. Examples: users, posts, comments, products. A model describes this thing in an object, with its data fields and auxiliary methods. It's usually through models that you interact with the database, create new items, delete or update items.</p> <p>There's a bit of an art in how to design your database and application, and we <a href="/webdevbook/backend/architecture.html">talked a bit about what questions you should ask yourself</a>. Particularly if you are using a relational database -- which we are here -- you want to take proper care of relationships between models. Relational databases don't have arrays as a native type, so if you have any field that is an array it's likely that you'll model it as a relationship.</p> <p>When you are at the drawing board, make a list of all the types you expect in your application. Then specify which fields they have. If a field is array, split it into a separate model; for example, if a user can have multiple addresses, you'll want a <code>User</code> and an <code>Address</code> models, while if they're only going to have one the address fields can be part of <code>User</code>. Relationships are these &quot;links&quot; between your models. Relationships are described by their cardinality, that is, how many of one type are expected to be connected to other types, such as one-to-one or one-to-many. We'll describe cardinalities below.</p> <p>Let's see about this. We'll briefly go over the different relationship types and how they're modeled in GraphQL, and then explain how to implement in Laravel.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you are using Modelarium all the PHP code for relationships described in this section will be generated automatically for you from the GraphQL code.</p></div> <p>In Laravel we must declare relationships on the models, so it knows what types to expect and what cardinality. Laravel has an <a href="https://laravel.com/docs/eloquent" target="_blank" rel="noopener noreferrer">ORM called Eloquent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, which is a layer to access the database without writing SQL manually. Laravel also has [good documentation on relationships[(https://laravel.com/docs/eloquent-relationships), which this file mostly skims over. You'll also have to <a href="/webdevbook/backend/database.html">create your data on the database, which we'll talk about later</a>.</p> <h2 id="models-types-in-graphql"><a href="#models-types-in-graphql" class="header-anchor">#</a> Models (types) in Graphql</h2> <p>Graphql files will have a declaration for each model, declared as a <code>type</code>.</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Something</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token comment"># other fields...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>!</code> marks that field as required. Note that Graphql allows arrays of basic types, unlike SQL:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Something</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>String<span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span>
  <span class="token comment"># other fields...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>[String!]!</code> means &quot;a required list of non-null strings&quot;.</p> <p>Some attention may be required for arrays. LighthousePHP and Modelarium handle arrays for relationships, automatically generating the correct one-to-many or many-to-many code for you. You need to take more care when declaring arrays of basic types, since you'll have to so some sort of manipulation on the data coming from a relational database.</p> <h2 id="relationships"><a href="#relationships" class="header-anchor">#</a> Relationships</h2> <p>Modelarium and Lighthouse implement <code>@hasOne</code>, <code>@hasMany</code>, <code>@belongsTo</code>, <code>@belongsToMany</code> and so on, making it easy to declare all relationships from the GraphQL description alone and have their code generated for you, but we also show the counterpart PHP code.</p> <h3 id="one-to-one-relationships"><a href="#one-to-one-relationships" class="header-anchor">#</a> One to one relationships</h3> <p>If you expect a type to have a single relationship to another type, and vice-versa, that's a 1:1 relationship. A good example is with spouses: in most places if you are married, you have just one spouse and vice-versa. 1:1 relationships are usually uncommon. It's often simpler to put the data into a single table: for example, addresses. But sometimes it's wise to split into separate tables to make tables smaller, which can be more efficient. We'll <a href="/webdevbook/backend/database.html#one-to-one">describe the database code later</a>.</p> <p>Let's suppose our users can have only one pass, which is unique.</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">email</span><span class="token punctuation">:</span> Email<span class="token operator">!</span>
  <span class="token attr-name">pass</span><span class="token punctuation">:</span> Pass <span class="token directive function">@hasOne</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Pass</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">code</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">user</span><span class="token punctuation">:</span> User<span class="token operator">!</span>
    <span class="token directive function">@belongsTo</span>
    <span class="token directive function">@migrationForeign</span><span class="token punctuation">(</span><span class="token attr-name">onDelete</span><span class="token punctuation">:</span> <span class="token string">&quot;cascade&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">onUpdate</span><span class="token punctuation">:</span> <span class="token string">&quot;cascade&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note that we don't declare <code>pass: Pass!</code>, but <code>pass: Pass</code>. This is because we'll have to create one of the entries first, and we want to avoid a circular &quot;User needs Pass&quot; and &quot;Pass needs User&quot; dependency.</p> <p>In PHP, you need to declare these relationships in the models:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Relations<span class="token punctuation">\</span>HasOne</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HasOne
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasOne</span><span class="token punctuation">(</span>\<span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Pass</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now we also define the inverse relationship:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Relations<span class="token punctuation">\</span>BelongsTo</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Pass</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> BelongsTo
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>\<span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note that we are declaring the return types in both cases, which is not always done in the Laravel examples you see around. This is relevant for reflection operations that are used by LighthousePHP and Modelarium, and it's a good practice as well.</p> <h3 id="one-to-many-relationships"><a href="#one-to-many-relationships" class="header-anchor">#</a> One to many relationships</h3> <p>This is a common case. One model has a single relationship to another, but the other can be related to many of the original type. This is the case of Book and Publisher: each book has only one publisher, but each publisher can publish many books. Other examples: Post&lt;-&gt;Comment, User&lt;-&gt;Post. We'll <a href="/webdevbook/backend/database.html#one-to-many">describe the database code later</a>.</p> <p>So let's start with a basic 1:n relationship. We have users and they can make posts. Each user can make as many posts as they way, but each post is made by just one author. Here's how we can describe it in GraphQL:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">email</span><span class="token punctuation">:</span> Email<span class="token operator">!</span>
  <span class="token attr-name">posts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Post<span class="token operator">!</span><span class="token punctuation">]</span> <span class="token directive function">@hasMany</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">content</span><span class="token punctuation">:</span> Text<span class="token operator">!</span>
  <span class="token attr-name">user</span><span class="token punctuation">:</span> User<span class="token operator">!</span>
    <span class="token directive function">@belongsTo</span>
    <span class="token directive function">@migrationForeign</span><span class="token punctuation">(</span><span class="token attr-name">onDelete</span><span class="token punctuation">:</span> <span class="token string">&quot;cascade&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">onUpdate</span><span class="token punctuation">:</span> <span class="token string">&quot;cascade&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When users are created they never made a post yet, so we don't make the field required. But posts are always created by a user. Note that we declared posts as an array: <code>posts: [Post!]</code>. But they are a relationship, and we declare that with <code>@hasMany</code> and <code>@belongsTo</code> directives. These directives are processed by Lighthouse and GraphQL, together with <code>@migrationForeign</code> to specify a foreign key.</p> <p>Here's how to write this model relationship. Note that we now use <code>HasMany</code>, and that <code>posts</code> is plural.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Relations<span class="token punctuation">\</span>HasMany</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HasMany
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span>\<span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now we also define the inverse relationship:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Relations<span class="token punctuation">\</span>BelongsTo</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Get the spouse record associated with the user.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> BelongsTo
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>App\<span class="token package">Models<span class="token punctuation">\</span>User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The nice thing about relationships using an ORM like Eloquent is that we can easily probe them:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">posts</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$posts</span> <span class="token keyword">as</span> <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Or through the inverse:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$post</span> <span class="token operator">=</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="many-to-many-relationships"><a href="#many-to-many-relationships" class="header-anchor">#</a> Many to many relationships</h3> <p>Sometimes, however, both sides of relationship might have a multiple cardinality. For example, an <code>User</code> might be in several <code>Project</code>, and each <code>Project</code> will also have multiple <code>User</code>. SQL relationships don't allow arrays, so we'll need a third table to link both, known as a link table or associate table. The models will point to this intermediary table. We'll <a href="/webdevbook/backend/database.html#many-to-many">describe the database code later</a>.</p> <p>It's easy to declare a many-to-many relationship in GraphQL:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">email</span><span class="token punctuation">:</span> Email<span class="token operator">!</span>
  <span class="token attr-name">projects</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Project<span class="token operator">!</span><span class="token punctuation">]</span> <span class="token directive function">@hasMany</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Project</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">users</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>User<span class="token operator">!</span><span class="token punctuation">]</span> <span class="token directive function">@belongsToMany</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The PHP code for the model is not that complicated either.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Relations<span class="token punctuation">\</span>HasMany</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">projects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HasMany
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span>\<span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Project</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now we also define the inverse relationship:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Relations<span class="token punctuation">\</span>BelongsToMany</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Project</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Get the spouse record associated with the user.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> BelongsTo
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>App\<span class="token package">Models<span class="token punctuation">\</span>User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="polymorphic-relationships"><a href="#polymorphic-relationships" class="header-anchor">#</a> Polymorphic relationships</h3> <p>Sometimes a model type will need to have a relationship to several other types, not just one. For example, you might have a <code>Comment</code> model, and these comments might be related for <code>Post</code> or <code>Project</code>. Or you can have media, and the <code>Media</code> type should allow relationships to <code>User</code> and <code>Place</code>. These are polymorphic relationships.</p> <h3 id="polymorphic-one-to-one"><a href="#polymorphic-one-to-one" class="header-anchor">#</a> Polymorphic one-to-one</h3> <p>We can imagine a system that each image is associated with only one post or user, and each post or user can only have one image. This is very similar to a monomorphic relationship. The difference is in the return types and in how we must declare the relationship with its field name. In this case <code>imageable</code> describes the table row name: there will be <code>imageable_id</code> and <code>imageable_type</code> rows in the <code>images</code> table to describe the relationship, as detailed in the <a href="/webdevbook/backend/database.html#polymorphic-one-to-one">database section</a>.</p> <p>TODO: Graphql</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">Image</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">imageable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> MorphTo
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> MorphOne
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphOne</span><span class="token punctuation">(</span>App\<span class="token package">Models<span class="token punctuation">\</span>Image</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'imageable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Get the user's image.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> MorphOne
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">morphOne</span><span class="token punctuation">(</span>App\<span class="token package">Models<span class="token punctuation">\</span>Image</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'imageable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="polymorphic-many-to-one"><a href="#polymorphic-many-to-one" class="header-anchor">#</a> Polymorphic many-to-one</h3> <p>TODO</p> <h3 id="polymorphic-many-to-many"><a href="#polymorphic-many-to-many" class="header-anchor">#</a> Polymorphic many-to-many</h3> <p>TODO</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/webdevbook/backend/testing.html" class="prev">
        Testing
      </a></span> <span class="next"><a href="/webdevbook/backend/database.html">
        Database
      </a>
      →
    </span></p></div> </main> <footer data-v-136409f7><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-136409f7><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" style="border-width: 0;" data-v-136409f7></a> <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type" data-v-136409f7>A full stack approach to integrated web and native app development</span>
  by
  <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName" data-v-136409f7>Bruno Barberi Gnecco</span>
  is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-136409f7>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International
    License</a>.
</footer></div><div class="global-ui"></div></div>
    <script src="/webdevbook/assets/js/app.644400d4.js" defer></script><script src="/webdevbook/assets/js/2.853235cf.js" defer></script><script src="/webdevbook/assets/js/16.e92f5043.js" defer></script>
  </body>
</html>
