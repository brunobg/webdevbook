<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Authentication | Full stack Web and Native Development</title>
    <meta name="generator" content="VuePress 1.5.1">
    
    <meta name="description" content="Creating native and web apps using Vue, NativeScript and Laravel">
    <link rel="preload" href="/assets/css/0.styles.7e4b3e23.css" as="style"><link rel="preload" href="/assets/js/app.10938997.js" as="script"><link rel="preload" href="/assets/js/2.7bd00ffb.js" as="script"><link rel="preload" href="/assets/js/19.d06c9906.js" as="script"><link rel="prefetch" href="/assets/js/10.ecb2b35d.js"><link rel="prefetch" href="/assets/js/11.668c04e1.js"><link rel="prefetch" href="/assets/js/12.7bd3ab23.js"><link rel="prefetch" href="/assets/js/13.9373112b.js"><link rel="prefetch" href="/assets/js/14.a44daf49.js"><link rel="prefetch" href="/assets/js/15.acfcc4da.js"><link rel="prefetch" href="/assets/js/16.304bd6ae.js"><link rel="prefetch" href="/assets/js/17.dc02afff.js"><link rel="prefetch" href="/assets/js/18.f0d3271f.js"><link rel="prefetch" href="/assets/js/20.dd6b07b3.js"><link rel="prefetch" href="/assets/js/21.7edad848.js"><link rel="prefetch" href="/assets/js/22.901473fe.js"><link rel="prefetch" href="/assets/js/23.f9d1d186.js"><link rel="prefetch" href="/assets/js/24.283da734.js"><link rel="prefetch" href="/assets/js/25.a41070f5.js"><link rel="prefetch" href="/assets/js/26.6913f4ea.js"><link rel="prefetch" href="/assets/js/27.bfdbc3cb.js"><link rel="prefetch" href="/assets/js/28.d9525154.js"><link rel="prefetch" href="/assets/js/29.40bf433c.js"><link rel="prefetch" href="/assets/js/3.70b562fb.js"><link rel="prefetch" href="/assets/js/30.fb8065ff.js"><link rel="prefetch" href="/assets/js/31.f8831942.js"><link rel="prefetch" href="/assets/js/32.9318217e.js"><link rel="prefetch" href="/assets/js/4.99e7b2a0.js"><link rel="prefetch" href="/assets/js/5.f0c0dcb8.js"><link rel="prefetch" href="/assets/js/6.512d59c2.js"><link rel="prefetch" href="/assets/js/7.2dbe39f9.js"><link rel="prefetch" href="/assets/js/8.74aba7b0.js"><link rel="prefetch" href="/assets/js/9.0666d488.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7e4b3e23.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Full stack Web and Native Development</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Frontend</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/frontend/interface.html" class="sidebar-link">Building the interface</a></li><li><a href="/frontend/debug.html" class="sidebar-link">Code and debugging tips</a></li><li><a href="/frontend/deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/frontend/routing.html" class="sidebar-link">Routing</a></li><li><a href="/frontend/stateandstorage.html" class="sidebar-link">State and storage</a></li><li><a href="/frontend/authentication.html" aria-current="page" class="active sidebar-link">Authentication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/authentication.html#local-logins" class="sidebar-link">Local logins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/authentication.html#sign-ups-registration" class="sidebar-link">Sign ups/registration</a></li><li class="sidebar-sub-header"><a href="/frontend/authentication.html#login" class="sidebar-link">Login</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/authentication.html#oauth" class="sidebar-link">OAuth</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/authentication.html#web" class="sidebar-link">Web</a></li><li class="sidebar-sub-header"><a href="/frontend/authentication.html#nativescript" class="sidebar-link">Nativescript</a></li><li class="sidebar-sub-header"><a href="/frontend/authentication.html#asking-the-user-for-more-data" class="sidebar-link">Asking the user for more data</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/authentication.html#logout" class="sidebar-link">Logout</a></li><li class="sidebar-sub-header"><a href="/frontend/authentication.html#routing-and-authenticated-pages" class="sidebar-link">Routing and authenticated pages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/authentication.html#native" class="sidebar-link">Native</a></li></ul></li></ul></li><li><a href="/frontend/communication.html" class="sidebar-link">Communication with the backend</a></li><li><a href="/frontend/models.html" class="sidebar-link">Models and collections</a></li><li><a href="/frontend/testing.html" class="sidebar-link">Testing and Deployment</a></li><li><a href="/frontend/i18n.html" class="sidebar-link">Internationalization (i18n)</a></li><li><a href="/frontend/pushcommunication.html" class="sidebar-link">Push communication</a></li><li><a href="/frontend/camera.html" class="sidebar-link">Camera</a></li><li><a href="/frontend/sharing.html" class="sidebar-link">Sharing</a></li><li><a href="/frontend/caching.html" class="sidebar-link">/frontend/caching.html</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Backend</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h1> <p>You'll likely need users to authenticate on your app. There are currently a few choices for telling a server who the user making a request is:</p> <ul><li><em>sessions with cookies</em>. You store a cookie on the browser when the user logins. Every request sends this cookie automatically. This is prone to CSRF attacks and does not play very well with native apps. These were widely used a few years ago.</li> <li><em>JWT (JSON web tokens)</em>. This is a standard to represent data securely between parties and verify claims. You store data about the client (such as user name and id) on a JSON structure, which is encoded and signed or encrypted. The advantage here is that you can store information, which might be interesting for microservices, as it contains verifiable data and can avoid a DB hit. JWTs have a lifetime in it, and so need to be renovated periodically. JWTs are not easy, however, to be individually revoked; you either need to check them against the DB and therefore lose one of its great advantages, or you need to provide short-lived JWTs which are renovated often. It avoids CSRF attacks since the browser does not send it automatically.</li> <li><em>a bearer token</em>. This is a simple string that is used for authorization, usually sent as an extra header. It's essentially a key that is looked up on a database or cache to get the user information. It avoids CSRF attacks since the browser does not send it automatically, and are easy to revoke, but require some form.</li></ul> <p>For the frontend JWT and bearer tokens are very similar, since in both cases you send them as part of your requests. We'll show how to implement a bearer token authorization for this app, both with local logins and with 3rd party OAuth logins.</p> <h3 id="designing-a-good-login-sign-up-form"><a href="#designing-a-good-login-sign-up-form" class="header-anchor">#</a> Designing a good login/sign up form</h3> <p>Avoid too many fields in your sign up form. Ideally your application will require only email and password (or the OAuth login). Are you sure you need a unique username? If you do, add that. Every extra field you add makes people more prone to give it up because there's too much to fill.</p> <p>Remember that social logins often have branding guidelines, like <a href="https://developers.google.com/identity/branding-guidelines" target="_blank" rel="noopener noreferrer">Google<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Follow them when implementing your buttons.</p> <h2 id="local-logins"><a href="#local-logins" class="header-anchor">#</a> Local logins</h2> <p>A local login does not validate against a third party; you use an email or unique user name and a password to validate against your database and authorize the user. It's a bit simpler to implement, but the user has to create another account for your service, with another password and so on. It adds friction.</p> <h3 id="sign-ups-registration"><a href="#sign-ups-registration" class="header-anchor">#</a> Sign ups/registration</h3> <p>Our registration flow is like this.</p> <ol><li>validate user data on the client and show any errors</li> <li>request user registration on the server. User is created on the server, check for errors</li> <li>perform the login flow on the server.</li></ol> <p>By separating in two steps, one for registration and another for login, we ensure that any changes to the login procedure (such as processing user data to do something on the app) are performed exactly the same on the registration and avoid maintaining two paths.</p> <p>TODO</p> <h3 id="login"><a href="#login" class="header-anchor">#</a> Login</h3> <p>Our login will work like this:</p> <ol><li>send a login request to the server with the username and password.</li> <li>get the user data back or an authentication error.</li> <li><a href="/frontend/stateandstorage.html">store user data</a></li> <li>navigate to the home page or the user page. If your login is in a modal, you can refresh the page instead by emitting an event.</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>processing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">.</span>email<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">.</span>password<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>processing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;updateUser&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>Home<span class="token punctuation">,</span> <span class="token string">&quot;/home&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>clearHistory<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>processing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The actual rest call is here:</p> <p>&lt;x&lt;x&lt; @ /../client/src/modules/rest.js#login-local</p> <h2 id="oauth"><a href="#oauth" class="header-anchor">#</a> OAuth</h2> <p>OAuth is a protocol to authorize services securely. Imagine you have a friend that wants to use your account service. If you give her your password, she will have access to your entire account and be able to do anything; but you only want her to be able to watch movies, not see your billing information. OAuth comes to solve this kind of problem, between computers. Its most common use is to authenticate users through a 3rd party -- such as Google or Facebook.</p> <p>OAuth requires integration from the backend and frontend. If you are using a different backend than the one described in this book you may need a different approach than the one described here -- but the idea is always the same. While you can use OAuth without involving a backend, we still need to create the user in our database if he never logged in before, and we need to authorize him on our server to fetch his data.</p> <p>You don't need to understand much of the OAuth protocol to use it, but <a href="https://oauth.net/getting-started/" target="_blank" rel="noopener noreferrer">here's a detailed introduction to OAuth 2.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> if you are curious.</p> <p>Remember to fill <code>VUE_APP_OAUTH_CLIENT_ID</code> (usually 2), and you can <code>VUE_APP_OAUTH_CLIENT_SECRET</code> <a href="/backend/authentication.html#setup">from your server</a> on your <code>.env.local</code> file. In this example we'll use Google for our authentication. We get our Google id from <code>process.env.VUE_APP_OAUTH_GOOGLE_CLIENT_ID</code> in our <code>.env.local</code> file. Get one from <a href="https://console.developers.google.com/" target="_blank" rel="noopener noreferrer">Google<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="web"><a href="#web" class="header-anchor">#</a> Web</h3> <p>Let's use <a href="https://github.com/diadal/vue-social-auth" target="_blank" rel="noopener noreferrer">vue-social-auth<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, as it handles Vue and <a href="https://socialiteproviders.netlify.app/" target="_blank" rel="noopener noreferrer">Socialite<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in the backend. <code>main.js</code> includes it:</p> <p>&lt;x&lt;x&lt; @ /../client/src/main.js#oauth</p> <p>All the OAuth code goes to <code>components/LoginExternal.vue</code>. The main flow is simple to follow:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">AuthProvider</span><span class="token punctuation">(</span><span class="token parameter">provider</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// authenticate throught the plugin</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$auth<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>message <span class="token operator">==</span> <span class="token string">&quot;Auth popup window closed&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// user gave up with logging in</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// we are authenticated, so let's register on the server</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerSocial</span><span class="token punctuation">(</span>provider<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// server returned our data. let's go home.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>Home<span class="token punctuation">,</span> <span class="token string">&quot;/home&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>clearHistory<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><code>registerSocial()</code> validates on the backend, which creates the user if necessary. It gets user data and token, storing on Vuex. This is all we need on the frontend.</p> <h3 id="nativescript"><a href="#nativescript" class="header-anchor">#</a> Nativescript</h3> <p>TODO
<code>nativescript-oauth</code></p> <h3 id="asking-the-user-for-more-data"><a href="#asking-the-user-for-more-data" class="header-anchor">#</a> Asking the user for more data</h3> <p>Occasionally you need more data from the user than the OAuth provider returns to complete the registration. For example, you might need their physical address or a choice of account type. On a regular registration with local login you just add all the fields to the registration form, but with OAuth you don't have this possibility.</p> <p>You can handle it with this flow:</p> <ol><li>make the authentication with the provider</li> <li>call the backend with the OAuth data. Create the user on the backend with empty data for the extra fields.</li> <li>open a modal dialog with the form for the extra data you need.</li> <li>send the extra data as an update to the backend.</li> <li>finish the login flow on the frontend.</li></ol> <h2 id="logout"><a href="#logout" class="header-anchor">#</a> Logout</h2> <p>Since we are using a standard for the authentication in the frontend, logout is the same for both OAuth and local logins. We want to:</p> <ol><li>notify the server (optional, but so it can invalidate the token)</li> <li>clear user data storage</li> <li>navigate to the main/login page</li></ol> <p>We implement logout like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/me/logout</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      data<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      method<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  vue<span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;logout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Notice that we actually commit a logout on Vuex while the backend request is still happening. The reason is that if we have some problem with the backend or network we still let the user logout and erase their credentials from the device. The server might have a lingering token in this case. If you absolutely need to revoke the token on the server, make sure to commit in a <code>then()</code> callback.</p> <h2 id="routing-and-authenticated-pages"><a href="#routing-and-authenticated-pages" class="header-anchor">#</a> Routing and authenticated pages</h2> <p>Not all pages of an application should be accessible from unauthenticated users. We'll use the vue router to control which pages are accessible and which are not. Web applications have unique URLs that can be accessed at any time.</p> <p>Going <a href="/frontend/routing.html">back to our router</a>, we extend the data structure with a <code>meta</code> field:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    mode<span class="token operator">:</span> <span class="token string">&quot;history&quot;</span><span class="token punctuation">,</span>
    routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">&quot;Main&quot;</span><span class="token punctuation">,</span>
            component<span class="token operator">:</span> viewsWeb<span class="token punctuation">.</span>Main<span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
                unauthorized<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//...</span>
</code></pre></div><p>Pages that can be accessed without authentication have the <code>unauthorized: true</code> field. This is checked on each route execution on <code>beforeEach</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// checks meta.unauthorized</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isLogged <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// check if store has an authenticated user</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>unauthorized <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isLogged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// user is not authenticated</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> redirect<span class="token operator">:</span> to<span class="token punctuation">.</span>path <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We provide a param to the login path, enabling us to redirect the user to the chosen page after the login is performed.</p> <h3 id="native"><a href="#native" class="header-anchor">#</a> Native</h3> <p>In the native version we have full control of the application and users cannot access a random page ordinarily. If your app supports <a href="https://market.nativescript.org/plugins/nativescript-plugin-universal-links" target="_blank" rel="noopener noreferrer">universal links<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, you'll have to provide a callback function. You can check on this callback if the user needs to be authenticated and route him to a login page or the chosen page.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/stateandstorage.html" class="prev">
        State and storage
      </a></span> <span class="next"><a href="/frontend/communication.html">
        Communication with the backend
      </a>
      →
    </span></p></div> </main> <footer data-v-136409f7><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-136409f7><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" style="border-width: 0;" data-v-136409f7></a> <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type" data-v-136409f7>A full stack approach to integrated web and native app development</span>
  by
  <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName" data-v-136409f7>Bruno Barberi Gnecco</span>
  is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" data-v-136409f7>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International
    License</a>.
</footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.10938997.js" defer></script><script src="/assets/js/2.7bd00ffb.js" defer></script><script src="/assets/js/19.d06c9906.js" defer></script>
  </body>
</html>
